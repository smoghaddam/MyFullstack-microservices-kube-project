---
- name: copying app  file
  copy:
    src: "{{ item }}"
    dest: ~/
    mode: 0774
  with_items:
    - run_docker.sh
    - upload_docker.sh

- name: Creates directory
  file:
    path: '~/{{ envname }}'
    state: directory

- name: copying app app.py file
  copy:
    src: app.py
    dest: '~/'

- name: copying app Dockerfile file
  copy:
    src: Dockerfile
    dest: '~/'

- name: copying app requirements.txt file
  copy:
    src: requirements.txt
    dest: '~/'

- name: copying app Makefile file
  copy:
    src: Makefile
    dest: '~/'

- name: copying app Makefile file
  copy:
    src: model_data
    dest: '~/'

- name: Setting venv, installing hadolint, runnint on docker
#  become: true
  shell: |
    sudo chmod ugo+rw app.py Dockerfile requirements.txt Makefile
    sed -i 's/_envToSet_/{{ envname }}/g' Makefile
    make setup
    source ".{{ envname }}/bin/activate"
    make install


- name: liting docker and running application
#  become: true
  shell: |
    make setup
    source ".{{ envname }}/bin/activate"
    make lint
    ./run_docker.sh

# python3 -m venv "{{ envname }}"
# source "{{ envname }}/bin/activate"
# cd "{{ envname }}"
# sudo chmod ugo+rw app.py Dockerfile requirements.txt Makefile
# sed -i 's/_envToSet_/{{ envname }}/g' Makefile
# make install
# # Install hadolint
# sudo wget -O /bin/hadolint https://github.com/hadolint/hadolint/releases/download/v1.16.3/hadolint-Linux-x86_64
# sudo chmod +x /bin/hadolint

