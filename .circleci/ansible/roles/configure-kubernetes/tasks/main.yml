---
- name: Installing Kubernetes with google-cloud-sdk
  shell: |
    curl -O https://dl.google.com/dl/cloudsdk/channels/rapid/downloads/google-cloud-sdk-342.0.0-linux-x86_64.tar.gz
    tar xvfz google-cloud-sdk-342.0.0-linux-x86_64.tar.gz
    ./google-cloud-sdk/install.sh --quiet

- name: Setting environment variables for kubectl and getting cluster info
  shell: |
    newpath=$(awk '/PATH*:/ { if (!f) print $0; f = 1 }' .bash_profile)':/home/ec2-user/google-cloud-sdk/bin'
    sed -i '/PATH*:/c\'"$newpath" .bash_profile

- name: Installing kubectl and minikube and starting clusters
  shell: |
    ./google-cloud-sdk/bin/gcloud --quiet components install kubectl
    ./google-cloud-sdk/bin/gcloud --quiet components install minikube
    ./google-cloud-sdk/bin/minikube start

- name: Setting environment variables for kubectl and getting cluster info
  shell: |
    source .bash_profile
    kubectl cluster-info